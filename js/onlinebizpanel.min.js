var onlineBizPanel=function(e,n){function p(){a.toggleClass("ob-expanded ob-collapse"),t.toggleClass("ob-fadeOut ob-fadeIn"),o.find("i").toggleClass("rotate-up")}function u(e,n){var o=e?t:i;o.addClass("ob-hide"),o.toggleClass("ob-fadeOut ob-fadeIn"),n.removeClass("ob-hide"),n.outerHeight(),n.toggleClass("ob-fadeOut ob-fadeIn"),e||d.set(a[0])}function c(e){p()}function f(n){u(!1,t),s.addClass("ob-hide"),e(".bottom-wrap, .top-wrap").remove()}function b(n){n.preventDefault();var a=e(this).attr("data-businessname"),t=ajaxManager.search("businessName",a),o=u.bind(null,!0,i);s.removeClass("ob-hide"),v(t,o)}function g(e){var n=e.target.scrollTop;n>=6&&r&&(o.addClass("drop-shadow"),r=!1),5>=n&&(o.removeClass("drop-shadow"),r=!0),d.update(n),n===e.target.scrollHeight-e.target.clientHeight&&(console.log("load more data!"),ajaxManager.loadMore(10,w))}function h(e){d.save()}function m(e,a){var t=n.createElement(e);return a&&Object.keys(a).forEach(function(e){t.setAttribute(e,a[e])}),t}function v(a,t){var o,s=n.createDocumentFragment(),l=m("div",{"class":"top-wrap clearfix"}),r=m("div",{"class":"bottom-wrap"}),d=m("h2"),p=m("a",{"class":"ob-phone",href:"tel:"+a.phone}),u=m("a",{href:a.website,target:"_blank"}),c=m("p"),f=m("hr"),b=a.logo?m("img",{src:a.logo,alt:a.businessName}):void 0,g=a.mainimage?m("img",{src:a.mainimage,alt:a.businessName}):void 0;b?e(l).append(b):b,e(l).append(d),e(l).append(p),e(d).append(a.businessName),e(p).append(a.phone),e(s).append(l),e(r).append(c),e(r).append(u),g?e(r).append(f,g):g,e(c).append(a.details),e(u).append(a.website),e(s).append(r),i.append(s),o=b?b:g,o?e(o).load(t):t()}function C(e,n){return e.length>n?e.slice(0,n-3)+"...":e}function w(a){var o=n.createDocumentFragment();a.forEach(function(n){var a=m("li",{"class":"ob-fadeOut"}),t=m("a",{"class":"ob-details",href:"#","data-businessname":n.businessName}),i=m("p"),s=m("div",{"class":"ob-phone"}),l=m("a",{href:n.website,target:"_blank"}),r=m("h2"),d=C(n.details,73);e(a).append(t,s,l),e(r).append(n.businessName),e(i).append(d),e(t).append(r,i),e(s).append(n.phone),e(l).append(n.website),e(o).append(a)}),t.append(o),setTimeout(function(){t.children("li").removeAttr("class")},350)}function k(){a.hasClass("ob-expanded")&&p()}function D(){a.hasClass("ob-collapse")&&p()}function x(n){a=e(n.listContainer),t=e(n.listInnerContainer),o=e(n.toggleElement),i=e(n.fullDetails),s=e(n.backButton),ajaxManager.loadData(w),o.bind("click",c),t.on("click",'a[class^="ob-details"]',b),a.on("scroll",g),s.bind("click",f),t.on("mousedown",h.bind(d))}var a,t,o,i,s,l,r=!0,d={top:[],temp:null,update:function(e){this.temp=e},save:function(){this.top.push(this.temp)},set:function(e){e.scrollTop=this.top[0],this.top.pop()}};return l={init:x,expand:D,collapse:k,buildList:w}}(jQuery,document);$(document).ready(function(){onlineBizPanel.init({listContainer:"#online-list-containter",listInnerContainer:"#online-list-containter ul",toggleElement:"#online-biz-toggle",fullDetails:"#ob-full-details",backButton:"#back-button"}),$("#loadbutton").bind("click",function(e){e.preventDefault(),ajaxManager.loadMore(10,onlineBizPanel.buildList)})});